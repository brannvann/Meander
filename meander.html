<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>Meander</title>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<meta name="generator" content="Geany 1.27" />
</head>

<body>
	<canvas id="field" width='600' height='600'></canvas>
	
	<script>
		var c = document.getElementById("field");
		var x_offset = 100, y_offset = 100, W = c.width - x_offset, H = c.height - y_offset, N = 5, S = W/N;
		var ctx = c.getContext('2d');
		ctx.lineWidth=1;
		ctx.fillStyle='blue';
		c.addEventListener("click", onClick, false);
		
		
		var m =[[1, -1, 1, -1, 1],
				[-1, 1, -1, 1, -1],
				[1, -1, 0, -1, 1],
				[-1, 1, -1, 1, -1],
				[1, -1, 1, -1, 1]];
		
		function drawTile(i, j){
			if(m[j][i] == 0){
				return;
			}
			
			var x = i*S + x_offset, y = j*S + y_offset;
			
			ctx.fillStyle='lightgray';
			ctx.fillRect(x + 1, y + 1,S-2,S-2);
			switch( m[j][i] ){
				case 1 :
					ctx.beginPath();
					ctx.arc( x, y, S/2, 0, 0.5 * Math.PI );
					ctx.stroke();
					ctx.beginPath();
					ctx.arc( x + S , y + S, S/2, 1 * Math.PI, 1.5 * Math.PI );
					ctx.stroke();
					break;
				case -1 :
					ctx.beginPath();
					ctx.arc( x, y + S, S/2, 1.5 * Math.PI, 0 );
					ctx.stroke();
					ctx.beginPath();
					ctx.arc( x + S, y, S/2, 0.5 * Math.PI, 1 * Math.PI  );
					ctx.stroke();
					break;
				default:
					break;
			}
		}
		
		function drawField(){
			ctx.fillStyle='white';
			ctx.clearRect(0 + x_offset,0 + y_offset,W,H);
			//ctx.fillRect(0,0,W,H);
	
			ctx.fillStyle='blue';
			ctx.lineWidth=1;
			ctx.strokeRect(0 + x_offset,0 + y_offset,W,H);
			for(let k = 1; k <N; k++){
				ctx.fillRect(k*S + x_offset, 0 + y_offset, 1, H);
				ctx.fillRect(0 + x_offset, k*S + y_offset, W, 1);
			} 
			
			ctx.lineWidth=3;
			for(i = 0; i < N; i++) {
				for(j = 0; j < N; j++) {
					drawTile(i,j);
				}
			}
		}
		 
		function onClick(e) {
			var x = Math.floor((e.pageX-x_offset)/S);
			var y = Math.floor((e.pageY-y_offset)/S);
			
			if( x >= 0 && y>=0 && x < N && y < N )		
				shiftFiled(y,x);
		} 	
		
		function shiftFiled(y, x) {
			if(m[y][x] == 0){
				ctx.fillStyle='lightgreen';
				ctx.fillRect(x*S+1 + x_offset, y*S+1 + y_offset,S-2,S-2);
				return;
			}
			var x_hole = 0, y_hole = 0;
			for( i = 0; i < N; i++){
				for( j = 0; j < N; j++) {
					if( m[i][j] == 0 ) {
						y_hole = i;
						x_hole = j;
					}
				}
			}
			if( x_hole == x ){
				var step = ( y_hole > y ) ? -1 : 1;
				for( k = y_hole; k != y; k += step )
					m[k][x] = m[k + step][x];
			}
			else if (y_hole==y){
				var step = ( x_hole > x ) ? -1 : 1;
				for( k = x_hole; k != x; k += step )
					m[y][k] = m[y][k + step];
			}
			else{
				return;
			}
			
			m[y][x] = 0;
			drawField();
		}	
		
		drawField();
		//setInterval(drawField, 200);
		
	</script>
</body>

</html>
